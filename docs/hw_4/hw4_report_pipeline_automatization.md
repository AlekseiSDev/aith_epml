# HW4 ‚Äî –æ—Ç—á–µ—Ç –ø–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ ML –ø–∞–π–ø–ª–∞–π–Ω–æ–≤

**–î–∞—Ç–∞:** 22 –¥–µ–∫–∞–±—Ä—è 2025  
**–ó–∞–¥–∞–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è ML –ø–∞–π–ø–ª–∞–π–Ω–æ–≤

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω –Ω–∞ Luigi —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ Pydantic.

## –í—ã–±—Ä–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

**–û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è:** Luigi 3.5.0+ ‚Äî –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–æ—Ä–∫—Ñ–ª–æ—É —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:** Pydantic 2.0.0+ ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π —Ç–∏–ø–æ–≤.

---

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –≠—Ç–∞–ø 1: –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Luigi

–°–æ–∑–¥–∞–Ω—ã 3 Luigi tasks —Å —á–µ—Ç–∫–æ–π —Ü–µ–ø–æ—á–∫–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π: `SplitDataTask` ‚Üí `TrainModelTask` ‚Üí `TestModelTask`.

**–§–∞–π–ª—ã:**
- [src/wine_quality_epml/pipeline/split_data_task.py](src/wine_quality_epml/pipeline/split_data_task.py) ‚Äî —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ train/eval/test.
- [src/wine_quality_epml/pipeline/train_model_task.py](src/wine_quality_epml/pipeline/train_model_task.py) ‚Äî –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ 10 –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤).
- [src/wine_quality_epml/pipeline/test_model_task.py](src/wine_quality_epml/pipeline/test_model_task.py) ‚Äî –æ—Ü–µ–Ω–∫–∞ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º —Å–ø–ª–∏—Ç–µ.
- [src/wine_quality_epml/pipeline/runner.py](src/wine_quality_epml/pipeline/runner.py) ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ CLI.
- [luigi.cfg](luigi.cfg) ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞.

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã: –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ `LocalTarget`, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `--workers` –∏ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ `requires()`.

**–ó–∞–ø—É—Å–∫:**
```bash
uv run python -m wine_quality_epml.pipeline.runner --local-scheduler
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

–î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π Luigi –ø–æ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–¥–∞—á —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω `MultiTrainTask`, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–±—É—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –º–æ–¥–µ–ª–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

**–ó–∞–ø—É—Å–∫ —Å 3 –≤–æ—Ä–∫–µ—Ä–∞–º–∏:**
```bash
uv run python -m wine_quality_epml.pipeline.runner --multi --workers 3 --local-scheduler
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —è–¥–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, RF, Ridge –∏ GBR) –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±—â–µ–≥–æ —ç—Ç–∞–ø–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö.

### –≠—Ç–∞–ø 2: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Pydantic

–°–æ–∑–¥–∞–Ω–æ 11 Pydantic –º–æ–¥–µ–ª–µ–π –¥–ª—è —Å—Ç—Ä–æ–≥–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:

**–§–∞–π–ª—ã:**
- [src/wine_quality_epml/config/schemas.py](src/wine_quality_epml/config/schemas.py) ‚Äî Pydantic —Å—Ö–µ–º—ã (SplitConfig, PathsConfig, –º–æ–¥–µ–ª–∏ ML, TrainConfig, ProjectConfig).
- [src/wine_quality_epml/config/loader.py](src/wine_quality_epml/config/loader.py) ‚Äî –∑–∞–≥—Ä—É–∑—á–∏–∫ YAML —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π:** `SplitConfig` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–ª–∞–Ω—Å –¥–æ–ª–µ–π –≤—ã–±–æ—Ä–æ–∫.
- **–¢–∏–ø–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π:** –ö–∞–∂–¥–∞—è –∏–∑ 10 –º–æ–¥–µ–ª–µ–π (Linear, Ridge, Lasso, GBR –∏ –¥—Ä.) –∏–º–µ–µ—Ç —Å–≤–æ–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `n_estimators >= 1`).
- **–ö–æ–º–ø–æ–∑–∏—Ü–∏—è:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ YAML-–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ (`base: path/to/base.yaml`) –∏ env overrides (–Ω–∞–ø—Ä–∏–º–µ—Ä, `WINE_QUALITY_TRAIN__MODEL_TYPE=lasso`).

---

### –≠—Ç–∞–ø 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Luigi Tasks

–ó–∞–¥–∞—á–∏ Luigi –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∑–∞–≥—Ä—É–∑—á–∏–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç "fail-fast" –ø–æ–≤–µ–¥–µ–Ω–∏–µ ‚Äî –ø–∞–π–ø–ª–∞–π–Ω —É–ø–∞–¥–µ—Ç –µ—â–µ –¥–æ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Ñ–∏–≥–µ.

**–ü—Ä–∏–º–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏:**
```python
def _load_config(self) -> ProjectConfig:
    return load_config(Path(str(self.params_path)))
```

**–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
–ú–æ–¥–µ–ª–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ `model_type` –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è—è –Ω—É–∂–Ω—ã–µ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–π Pydantic-—Å—Ö–µ–º—ã.

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —ç—Ç–∞–ø–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
```text
INFO: Data splitting: test=0.15, eval=0.15, seed=42
INFO: Splits created: train=779 rows, eval=172 rows, test=172 rows
INFO: Building gbr with params: {'n_estimators': 3000, 'learning_rate': 0.05, ...}
INFO: Training gbr...
INFO: üìä Pipeline Summary:
  Model: gbr
  Test R¬≤: 0.1181
  Test RMSE: 0.7355
```

---

## –ò—Ç–æ–≥–æ–≤—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã

### –°–∫—Ä–∏–Ω—à–æ—Ç—ã

**–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–∞–π–ø–ª–∞–π–Ω–∞ Luigi**  
![Luigi Pipeline Execution](hw4_1.jpg)

**–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (3 –≤–æ—Ä–∫–µ—Ä–∞)**  
![Parallel Execution](hw4_4.jpg)

**–í–∞–ª–∏–¥–∞—Ü–∏—è Pydantic**  
![Pydantic Validation](hw4_2.jpg)

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**  
![Integration Results](hw4_3.jpg)


### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è
```text
src/wine_quality_epml/
‚îú‚îÄ‚îÄ pipeline/              # Luigi tasks
‚îÇ   ‚îú‚îÄ‚îÄ split_data_task.py
‚îÇ   ‚îú‚îÄ‚îÄ train_model_task.py
‚îÇ   ‚îú‚îÄ‚îÄ test_model_task.py
‚îÇ   ‚îú‚îÄ‚îÄ multi_train_task.py # –ù–æ–≤–æ–µ: –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ runner.py
‚îî‚îÄ‚îÄ config/                # –°—Ö–µ–º—ã –∏ –∑–∞–≥—Ä—É–∑—á–∏–∫
    ‚îú‚îÄ‚îÄ schemas.py
    ‚îî‚îÄ‚îÄ loader.py
```

### –ö–æ–º–∞–Ω–¥—ã –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
uv sync --dev

# –ó–∞–ø—É—Å–∫ –ø–∞–π–ø–ª–∞–π–Ω–∞ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∫–æ–Ω—Ñ–∏–≥–æ–º
uv run python -m wine_quality_epml.pipeline.runner --params configs/ridge_baseline.yaml --local-scheduler
```

–ü–∞–π–ø–ª–∞–π–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω, —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é.
